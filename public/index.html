<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>GridSight™ — PLN Utility Intelligence Dashboard</title>
  <meta name="description" content="Public showcase WebGIS & KPI distribusi listrik berbasis cloud."/>
  <link rel="icon" href="./public/logo_pln.png"/>
  <style>
    :root{
      --bg:#061b2a;
      --bg2:#072233;
      --nav:#0a2b43;
      --text:#e7f6ff;
      --muted:#9ec8dd;
      --brand:#40c4ff;
      --accent:#7df2ff;
      --card:#0b2a41;
      --glass: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      --ring: rgba(64,196,255,.55);
      --shadow: 0 12px 26px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:radial-gradient(1000px 600px at 10% -10%, #0d3553 0%, #071f31 45%, #061b2a 100%), var(--bg); color:var(--text); font:15px/1.55 system-ui,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--brand);text-decoration:none}
    .wrap{max-width:1180px;margin:0 auto;padding:20px}
    /* header */
    .hdr{position:sticky;top:0;z-index:5;background:linear-gradient(180deg, rgba(0,0,0,.35), transparent);backdrop-filter:saturate(130%) blur(6px)}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:12px 20px; background:var(--nav); border-bottom:1px solid rgba(255,255,255,.07)}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:32px;height:32px;border-radius:8px;background:#fff;object-fit:cover}
    .brand .title{font-weight:800;letter-spacing:.2px}
    .brand .sub{color:var(--muted);font-size:12px;margin-top:-2px}
    .theme-pill{display:inline-flex;gap:8px;align-items:center;background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); color:#c8edff; padding:8px 12px; border-radius:999px; font-weight:700; box-shadow:var(--shadow)}
    .theme-pill span{opacity:.9}
    /* hero + panel */
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px;margin-top:16px}
    .panel{background:var(--glass); border:1px solid rgba(255,255,255,.08); border-radius:16px; box-shadow:var(--shadow)}
    .hero{overflow:hidden}
    .hero img{display:block;width:100%;height:100%;object-fit:cover; aspect-ratio: 16/10;}
    .card{padding:16px 16px 14px 16px}
    .eyebrow{color:#a8d8ee;letter-spacing:.25em;font-weight:800;font-size:11px}
    h1{margin:.35rem 0 8px 0;font-size:28px;line-height:1.15}
    .muted{color:var(--muted)}
    /* KPI */
    .kpi{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin:12px 0 8px}
    .k{background:rgba(8,40,60,.66);border:1px solid rgba(255,255,255,.10);border-radius:12px;padding:12px}
    .k small{color:#9fc6db;display:block;margin-bottom:6px}
    .k b{font-size:26px;letter-spacing:.6px}
    .divider{height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,.12),transparent); margin:10px 0}
    /* globe */
    .globe-card{margin-top:10px;background:rgba(8,40,60,.5);border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:10px}
    #globeCanvas{width:100%;height:260px;display:block;border-radius:10px;background:radial-gradient(900px 360px at -10% -20%, #114a6e 0%, #0a2f48 35%, #08283f 70%, #072133 100%)}
    /* info cards */
    .info-grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:14px}
    .info{background:var(--glass);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:14px}
    .info h3{margin:0 0 6px 0;font-size:16px;letter-spacing:.2px}
    .info p{margin:0;color:#a8c8da;line-height:1.55}
    .info ul{margin:6px 0 0 18px;color:#a8c8da;line-height:1.55}
    .info .pill{display:inline-block;background:#0b2233;border:1px solid rgba(255,255,255,.10);padding:2px 8px;border-radius:999px;font-size:12px;color:#9fdcff;margin-right:6px}
    @media (min-width:900px){ .info-grid{grid-template-columns:1fr 1fr 1fr} }
    /* actions */
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;margin-top:12px;flex-wrap:wrap}
    .left-note{font-size:12px;color:#a8c8da}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid rgba(255,255,255,.15); background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.05)); padding:10px 12px;border-radius:10px;color:#dff5ff;font-weight:700}
    .btn.primary{background:linear-gradient(180deg, #1aa6e6, #1784bd); border-color:#1aa6e6; color:#fff}
    .btn.ghost{background:transparent}
    .footer{opacity:.75;text-align:center;font-size:12px;margin:22px 0 30px}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header class="hdr">
    <div class="nav">
      <div class="brand">
        <img src="./public/logo_pln.png" alt="PLN"/>
        <div>
          <div class="title">GridSight™</div>
          <div class="sub">PLN Utility Intelligence Dashboard</div>
        </div>
      </div>
      <div class="theme-pill"><span>Hybrid</span> • <span>Modern</span> • <span>Intelligent</span></div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- LEFT: HERO -->
      <div class="panel hero">
        <img src="./public/hero_corporate.jpg" alt="PLN Corporate"/>
      </div>

      <!-- RIGHT: SUMMARY -->
      <div class="panel card">
        <div class="eyebrow">SHOWCASE PUBLIK</div>
        <h1>GridSight™ — PLN Utility Intelligence Dashboard</h1>
        <div class="muted">Public showcase WebGIS & KPI distribusi listrik berbasis cloud.</div>

        <div class="kpi">
          <div class="k"><small>Panjang JTM (km)</small><b id="jtmVal">431.27</b></div>
          <div class="k"><small>Panjang JTR (km)</small><b id="jtrVal">892.77</b></div>
          <div class="k"><small>Jumlah Pelanggan</small><b id="pelVal">23,874</b></div>
        </div>

        <div class="row" style="margin-top:0">
          <button id="refreshBtn" class="btn"><span>⟳</span> Refresh Data</button>
          <span class="left-note">Versi publik — peta & dataset aktif tersedia di server internal PLN.</span>
        </div>

        <div class="globe-card">
          <canvas id="globeCanvas" aria-label="Interactive globe"></canvas>
        </div>

        <!-- Informational cards -->
        <div class="info-grid">
          <div class="info">
            <h3>Tentang Dashboard</h3>
            <p>
              <span class="pill">Showcase Publik</span>
              <span class="pill">Read-only</span>
              <span class="pill">Cloud Friendly</span>
            </p>
            <p style="margin-top:8px">
              Halaman ini menampilkan <b>KPI distribusi listrik</b> dan elemen branding WebGIS tanpa memuat data internal.
              Versi operasional (internal) terhubung ke PostgreSQL/PostGIS & API Flask untuk perhitungan panjang jaringan
              dan jumlah pelanggan berdasarkan extent peta.
            </p>
          </div>

          <div class="info">
            <h3>Ringkasan Aset</h3>
            <ul>
              <li><b>Pelanggan</b>: <span id="sumPel">23.874</span> titik (contoh)</li>
              <li><b>JTM</b>: <span id="sumJtm">431,27</span> km &nbsp;•&nbsp; <b>JTR</b>: <span id="sumJtr">892,77</span> km</li>
              <li><b>Area</b>: Wilayah Cilacap (subset showcase)</li>
            </ul>
            <p style="margin-top:6px">Nilai di atas dummy untuk publik; angka riil ditarik dari DB internal.</p>
          </div>

          <div class="info">
            <h3>Potensi Pemanfaatan WebGIS</h3>
            <ul>
              <li>Monitoring panjang jaringan & pertumbuhan pelanggan per penyulang.</li>
              <li>Validasi topologi Utility Network (snap, arah aliran, cabang isolasi).</li>
              <li>Prioritisasi pemeliharaan & analisis gangguan berbasis spasial.</li>
              <li>Integrasi Dashboard (Power BI) & bot notifikasi (Telegram / n8n).</li>
            </ul>
          </div>
        </div>

        <!-- Actions -->
        <div class="row">
          <div class="left-note">Created by <b>Rega Syahrul</b></div>
          <div style="display:flex;gap:8px">
            <a class="btn ghost" href="https://github.com/regasyahrul-droid/utility_network_cilacap_public" target="_blank" rel="noopener">GitHub Repo</a>
            <a class="btn primary" href="/project/cilacap/map" target="_blank" rel="noopener">Open Map</a>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">© 2025 GridSight™ — Powered by PLN Intelligence</div>
  </main>

  <script>
    // —— Simple KPI refresher (dummy) ——
    const fmt = n => Number(n).toLocaleString('id-ID', {minimumFractionDigits:2, maximumFractionDigits:2});
    function refreshKPI(){
      // generate angka realistis tapi dummy
      const jtm = 380 + Math.random()*120;      // 380–500 km
      const jtr = 820 + Math.random()*140;      // 820–960 km
      const pel = 22000 + Math.floor(Math.random()*6000); // 22k–28k

      document.getElementById('jtmVal').textContent = fmt(jtm);
      document.getElementById('jtrVal').textContent = fmt(jtr);
      document.getElementById('pelVal').textContent = pel.toLocaleString('id-ID');

      // sinkron ke ringkasan aset
      document.getElementById('sumJtm').textContent = fmt(jtm).replace('.',',');
      document.getElementById('sumJtr').textContent = fmt(jtr).replace('.',',');
      document.getElementById('sumPel').textContent = pel.toLocaleString('id-ID');
    }
    document.getElementById('refreshBtn').addEventListener('click', refreshKPI);

    // —— Lightweight canvas "globe" (no libs) ——
    (function(){
      const canvas = document.getElementById('globeCanvas');
      const ctx = canvas.getContext('2d');
      let w,h,r;
      let t = 0;

      function resize(){
        const dpr = Math.max(1, window.devicePixelRatio || 1);
        w = canvas.clientWidth; h = canvas.clientHeight;
        canvas.width = Math.floor(w*dpr); canvas.height = Math.floor(h*dpr);
        ctx.setTransform(dpr,0,0,dpr,0,0);
        r = Math.min(w,h)*0.42;
      }
      window.addEventListener('resize', resize, {passive:true});
      resize();

      function draw(){
        ctx.clearRect(0,0,w,h);

        // center
        const cx = w*0.52, cy = h*0.55;

        // halo
        const g = ctx.createRadialGradient(cx,cy,r*0.6, cx,cy,r*1.15);
        g.addColorStop(0, 'rgba(64,196,255,.15)');
        g.addColorStop(1, 'rgba(64,196,255,0)');
        ctx.fillStyle = g;
        ctx.beginPath(); ctx.arc(cx,cy,r*1.15,0,Math.PI*2); ctx.fill();

        // sphere
        const sph = ctx.createRadialGradient(cx-r*0.35, cy-r*0.35, r*0.2, cx,cy, r);
        sph.addColorStop(0, '#1d769c');
        sph.addColorStop(1, '#0b3e5a');
        ctx.fillStyle = sph;
        ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.fill();

        // grid lines
        ctx.strokeStyle = 'rgba(180,240,255,.30)';
        ctx.lineWidth = 1;

        const meridians = 18, parallels = 9;
        const rot = t*0.002; // rotation

        // meridians
        for(let i=0;i<meridians;i++){
          const phi = i*(Math.PI*2/meridians)+rot;
          ctx.beginPath();
          for(let th=-Math.PI/2; th<=Math.PI/2; th+=0.07){
            // 3D -> 2D (simple sphere parametric)
            const x = r*Math.cos(th)*Math.cos(phi);
            const y = r*Math.sin(th);
            ctx.lineTo(cx+x, cy+y);
          }
          ctx.stroke();
        }
        // parallels
        for(let j=1;j<parallels;j++){
          const th = -Math.PI/2 + j*(Math.PI/parallels);
          const ry = r*Math.sin(th);
          const rx = r*Math.cos(th);
          ctx.beginPath();
          for(let phi=0; phi<=Math.PI*2+0.02; phi+=0.06){
            const x = rx*Math.cos(phi+rot);
            const y = ry;
            ctx.lineTo(cx+x, cy+y);
          }
          ctx.stroke();
        }

        // glow ring
        ctx.strokeStyle = 'rgba(125,242,255,.65)';
        ctx.lineWidth = 1.5;
        ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();

        t += 16;
        requestAnimationFrame(draw);
      }
      draw();
    })();
  </script>
</body>
</html>
